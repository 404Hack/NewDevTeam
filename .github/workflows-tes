name: WelcometoTeam

on:
  pull_request:
    types:
      - opened
      - synchronize

jobs:
  validar_pr:
    runs-on: ubuntu-latest
    steps:
    - name: Validar el nombre del branch
      if: ${{ github.event.pull_request.user.login != github.repository_owner }}
      run: |
        BRANCH_NAME="${{ github.head_ref }}"
        if [[ "$BRANCH_NAME" == "main" || "$BRANCH_NAME" == "master" ]]; then
          echo "El branch no puede ser 'main' o 'master'."
          exit 1
        fi
      shell: bash
    - name: Validar cambios en un archivo específico
      if: ${{ github.event.pull_request.user.login != github.repository_owner }}
      run: |
        FILE_TO_CHECK="ruta/del/archivo/especifico"
        if ! git diff --name-only HEAD^..HEAD | grep -q "$FILE_TO_CHECK"; then
          echo "No se encontraron cambios en el archivo."
          exit 1
        fi
      shell: bash
    - name: Validar comentarios en el commit
      if: ${{ github.event.pull_request.user.login != github.repository_owner }}
      run: |
        if ! git log --format=%B -n 1 HEAD | grep -qE ".*[a-zA-Z0-9]+.*"; then
          echo "El commit no contiene comentarios."
          exit 1
        fi
      shell: bash
    - name: Validar comentarios en la solicitud de extracción
      if: ${{ github.event.pull_request.user.login != github.repository_owner }}
      run: |
        COMMENTS=$(curl -s -H "Authorization: Bearer ${{ secrets.GITHUB_TOKEN }}" \
          "https://api.github.com/repos/${{ github.repository }}/pulls/${{ github.event.pull_request.number }}/comments")
        if [[ "$COMMENTS" == "[]" ]]; then
          echo "La solicitud debe incluir comentarios."
          exit 1
        fi
      shell: bash
